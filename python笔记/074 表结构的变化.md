## Review

## 1. 基本需求的表结构 

1. 权限表
   - url。权限(不包含^和$)
   - title  标题
2. 角色表
   - name
   - permissions = manytomanyfield
3. 角色和权限关系表
   - role_id 
   - permission_id
4. 用户名
   - username
   - pwd
   - roles = manytomanyfield
5. 用户和角色表
   - user_id
   - role_id

## 2. 菜单需求

1. 一级菜单
   - 权限表：多一个 is_menu 字段
   - icon：可有可无
2. 二级菜单
   - 新增：menu表：title icon 
     - permissoin只留url和title + 外键

## 今日内容

## 1. 一级菜单的排序

1. dict在3.6 是无序的，显示有序，3.7之后是有序的
2. 有序菜单(有序字典)
3. 给菜单加优先级

```python
# model.py，优先级设置最好有些跨度
weight = models.IntegerField(default=1)
```

```python
# my_tags.py
from collections import OrderDict
@register.inclusion_tag('menu.html')
def generator(request):
  	url = request.path
    menu_dic = request.session.get(settings.MENU_SESSION_KEY)
    od = OrderDict()
    keys = sorted(menu_dic, key=lambda x:menu_dic[x]['wight'] ,reverse=True)
    for i in keys:
        od[i] = menu_dic[i]
    
    for i in menu_dic.values():
      	i['class'] = 'hide'
      	for m in i['children']:
          	re.match(r'{}$'.format(m['url']), url)
            m['class'] = 'active'
            i['class'] = ''
    return {'menu_dic':od.values()}
```

## 2. 二级菜单开合

```js
$(this).parent().siblings().find('.body').addClass('hide')
```

## 3. 二级子菜单

```python
# models.py / permission 
# 自关联
parent = models.ForeignKey('self', null=True, blank=True)
```

```python
# 权限校验,中间件
for i in permissions:
  	if re.match(r'{}$'.format(i['url']), path):
        sid = i['id']
        pid = i['pid']
        if pid:
            request.current_menu_id = sid
        else:
            request.current_menu_id = id
        return 
```

```python
# my_tags.py
if reqest.current_menu_id == m['id']:
 		 m['class'] = 'active'
     i['class'] = ''
```

## 4. 路径导航(breadcrumb)

- json序列化时，字典中的**key**为数字为时，会变成字符串，反序列化后还是字符串
- 添加父权限导航
  - 数据库查询
  - pid 循环字典
  - 改变数据结构



























