# vi/vim

## 1. 打开、关闭文件

### 1. 打开文件

```SHELL
vim [option] filename
+n：光标定位到第n行
+/henry：光标到第一个匹配到的行首
-m：只读方式打开
-e：直接进入扩展命令行模式
-b：以二进制方式打开
```

### 2. 关闭文件

```SHELL
:q		# 退出
:q!		# 不保存，强制退出
:w		# 保存
:wq		# 保存退出
:wq!	# 强制的保存退出
:x		# 保存退出
```

```SHELL
ZZ		# 保存退出
ZQ		# 不保存退出
```

## 2. 模式的切换和操作

- 命令模式：打开后的默认模式
- 插入模式：编辑文件
- 扩展命令模式（末行模式）：保存或退出等
- 可视化模式：配合鼠标使用

### 1. 命令模式和插入模式

- 进入插入模式

```SHELL
i		# cursor所在位置前插入
I		# cursor行首插入
a		# cursor所在位置后插入
A		# cursor行尾插入
o		# cursor下一行
O		# cursor上一行
```

- 回到命令模式：**Esc键**

### 2. 命令模式和扩展命令模式

- 进入扩展命令模式

```SHELL
:		# shifit + :
```

- 命令模式的操作

```SHELL
:w						 # 保存文件到磁盘
:r filename    # 读入filename，在cursor的下一行插入其内容
:w filename  	 # 另存为
:!command			 # 执行终端命令
:r!command		 # cursor下一行插入执行结果
```

- 到命令模式：**两次Esc键**或者**Esc + Enter**

## 3. cursor移动

```SHELL
# 字符间移动
h j k l				# 左 下 上 右
# 单词间移动
w 						# 下一个单词词首
e							# 当前或下一个单词词尾，除了下划线(_) 都是单词分隔符
b							# 当前或下一个单词词首
num command   # 配合数字键使用，表示跳转 n 个字符或单词
# 行间移动
H							# cursor跳到，当前页第一行行首
M							# cursor跳到，当前页中间行首
L							# cursor跳到，当前页最后一行行首
zt						# 当前行移动到屏幕的顶端
zz						# 当前行移动到屏幕的中间
zb						# 当前行移动到屏幕的底端
0							# 跳转到行首
$							# 跳转到行尾
^							# 跳转到行首第一个非空白字符
gg/1G					# 跳转到文件第一行
G							# 跳转到文件末行
:10						# 跳转到第10行
10gg/10G			# 同上
# 段落间移动
{							# 上一段
}							# 下一段
# 翻屏
ctrl + f			# 下一屏
ctrl + d			# 下半屏
ctrl + u			# 上半屏
ctrl + b			# 上一屏
```

## 4. 操作

### 1.字符编辑

```SHELL
nx							# 删除cursor之后的文本(n个字符，默认一个)
xp							# 两个字符交换位置
p								# 黏贴到cursor
~								# 大小写转化
nJ							# 合并下 n 行，删除下 n 行换行符

rx							# 用 x 替换cursor所在位置后的单个字符
R								# 切换为 Replace 模式，可以连续替换
```

### 2. 删除d

```SHELL
dl							# 删除右边的一个字符，根据cursor移动删除
d0
d$/D
3dd							# 删除当前行和下2行
d^							# 从cursor位置删除到当前行第一个非空字符
dw							# 删除一个单词
de							# 删除到当前单词或下一个单词词尾
db							# 删除到当前单词或上一个单词词首
dG							# 删除到文件行尾
dgg							# 删除到文件行首
```

### 3. 复制y

```SHELL
y$							# 结合cursor跳转使用
5yy							# 复制5行
p 							# 粘贴到cursor位置(类似a)，如果是整行则粘贴到下一行
P(大写)					 # 粘贴到cursor位置前，如果是整行则粘贴到上一行
```

- 改变c(**直接切换到插入模式**)

```SHELL
cw							# 结合cursor跳转使用
cc							# 删除整行，并进入insert模式
ncc							# 删除 n 行
c$/C
```

- 插入n次henry

```SHELL
nihenry					# 插入n个henry
```

- 撤销u：最近的更改

```SHELL
nu							# 撤销之前的 n 次更改
U								# 撤销当前行的更改
ctrl+r					# 撤销 撤销
3.							# 重复上次操作，3次
```

- 搜索/（**可以使用正则**）

```SHELL
:/pattern				# 向下搜索指定pattern
:?pattern			  # 向上搜索指定pattern
n								# 和搜索命令相同方向跳转cursor
N								# 和搜索命令相反方向跳转cursor
```

## 5. 扩展的命令模式补充

### 1. 地址定界

```SHELL

:start,end			# 从start行到end行
:start,+end			# 从start行到 start+end 行
:2,5						# 2-5行
:2,+5						# 2-7行
:n							# 具体到第n行
:.							# 当前行
:$							# 最后一行
:$-2						# 倒数第 $-2 行
:%							# 全部
:n,/pattern/		# 从第n行到第一次pattern匹配行
:/pat1/,/pat2/	# 从第一次pat1匹配行到第一次pat2匹配行
:/pattern/,n		# 从第一次pattern匹配行到第 n 行
```

### 2. 使用方法(d/y/w/r)

```SHELL
:/pattern/,n w newfile		
:2,4 r b				# 在第4行，插入
d								# 删除
y								# 复制
w newfile				# 将指定范围内的文件另存为
r filename			# 将文件内容插入指定位置
```

### 3. 查找替换

1. :地址定位符s/pattern(正则)/替换的内容/装饰器

- 查找的内容可以使用正则表达式和分组，替换的内容可以引用，即\1, \2 等
- 也可以使用&代替查找的内容(不需要分组)

```SHELL
:%s/s..c/abc  	# 替换第一个匹配字符
:%s/\(sy.c\)/abc\1/ # 使用向后引用，正则的分组
```

2. 装饰器
   - i：忽略大小写
   - g：全部替换
   - gc：替换之前要确认(y,n,a,l,...)
   - / @ #：都可以作为查找替换的分隔符

## 6. 其他操作

### 1. 可视化模式

- 配合移动键使用
- 选中的文字可以被删除、复制、变更、过滤和替换等

1. v：面向字符
2. V：面向行
3. ctrl + v：面向块

### 2. 多文件操作

```SHELL
vim f1 f2 f2		# 打开多个文件
:next						# 切换下一个文件
:prev						# 切换下一个文件
:last
:first
# 退出
:wqall
:wall
:qall
```

### 3. 使用多个窗口

- 多个文件

```SHELL
vim -o f1 f2 f3	# 水平分屏
vim -O f1 f2 f3 # 垂直分屏
ctrl + w				# 切换窗口
```

- 单个文件

```SHELL
ctrl + w, s			# 水平分屏
ctrl + w, v			# 垂直分隔
ctrl + w,方向键	# 跳转
ctrl + w, q			# 取消相邻的屏幕
ctrl + w, o			# 取消全部窗口
```

### 4. 定制vim

- 全局配置文件：/etc/vimrc
- 当前用户配置文件：~/.vimrc

- 扩展命令模式(临时生效)

```SHELL
:set nu					# 设置行号
:set nonu				# 取消行号
:set ic					# 忽略大小写，搜索
:set noic
:set ai					# 自动缩进,与上一样对齐
:set noai
:set hls				# 搜索高亮
:set nohls
:syntax on			# 语法高亮
:syntax off
:set cul				# 设置光标所在行的标志符(下划线)
:set nocul
:set all				# 获取帮助
```

- 文件转换

```SHELL
# 转换为 windows 格式
:set fileformat=dos
# 转换为 Linux/unix
:set fileformat=unix
```

### 5. vim帮助信息

- :help    :help topic
- vimtutor
- vim + enter











