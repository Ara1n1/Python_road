## 1. find

### 1. 用法

1. `find [option]... [查找路径][查询条件][处理动作]`
2. 查找路径：可以指定目录，默认当前目录
3. 查找条件：用来指定文件查找的标准，文件名、大小、权限、类型等
4. 处理动作：对符合条件文件进行的操作，默认直接输出到屏幕

### 2. 查找条件

#### 1. -name：可以配合通配符使用

- 文件名：完全匹配
- 所有yi

```shell
# 使用名称查找，文件目录和文件只要符合都可以
find . -name a.txt		# 完全匹配
find -name a\?				# 所有以a开头后面有一个字母的文件或文件夹
find -name a\*				# 所有以a开头的文件或文件夹
find -anme 'a*'				# 所有以a开头的文件或文件夹
find -anme a[ab]			# 以a开头，后面字母是a/b的文件或文件夹
```

#### 2. -i ：忽略大小写

```shell
find -iname a					# 忽略大小写
```

#### 3. `-—maxdepth/--mindepth`

- 指定查找深度，搜索层数，指定目录为第一层

```shell
find --maxdepth 2 -name a
# 最小层数， 包括第二层
find --mixdepth 2 -name a
```

#### 4. -type：指定文件类型

- f：文件
- d：目录
- l：链接
- s：套接字
- b：块设备
- c：字符设备文件
- p：管道文件

```shell
find -type f -name a
find -type d -name a
find -type l -name a
find -type s /run -name *
```

#### 5. -empty：空文件夹

```shell
find -empty -type d      # 查找所有空目录
```

#### 6.  -user/-group：属主和组

```shell
find -user henry
find -group henry
```

#### 7. -uid/-gid：uid或gid的文件和目录

```shell
id henry								# 查看用户uid
find -uid 1000
find -gid 1000
```

#### 8. -nouser/-nogroup：没有属主的

- linux通过uid进行识别用户

```shell
find / -nouser 					# 用户被删除时，属主变成数字表示没有属主
find / -nogroup
```

#### 9. 组合条件

- 与：-a
- 或：-o
- 非：-not / ！
- 摩根定律
  - 非A或非B=非(A 且 B)
  - 非A且非B=非(A 或 B)

```shell
find -type f -o -nouser
find -not -user henry -a -not -user dean ll
find -not \( -user henry -o -not -user dean \) -ll
```

#### 10. -path：排除目录

```shell
find /etc/ -path /etc/ssh -name *_config
```

#### 11. ：文件大小

-  -n：[0, n-1]
-  n：查找在大小在(n-1 n ] 的文件且不等0的文件
-  +n：(n, )
- c：字节，K：kb，M：mb，G：gb

```shell
find -size 1c/K/M/G
# 生成 1M 文件
dd if=/dev/zero of =ccc bs=1M count=1
ll ccc

# 查找文件大小在[0, 1]的文件和目录
find -size -2M
# 查找文件大小在(1, 2]的文件和目录
find -size 2M
# 查找文件大小在(2,...)2M以上的文件和目录
find -size +2M
```

#### 12. 文件时间戳

- 默认时间戳以天为单位
  1. atime [+|-]/ mtime / ctime
  2. time：[time,time+1)时间为 time 天到 time+1 天之间的文件
  3. +time：[time+1….]
  4. -time：[0, tim)
- 以分钟为单位(和天一样)
  1. -amin
  2. -mmin
  3. -cmin

```shell
# 查找访问时间为[0, 1)天内的文件和目录
find -atime -1 -ls
# 查找访问时间为[1,2)天内的文件和目录
find -atime 1 -ls
# 查找访问时间为[2，....),2天以上的文件和目录
find -atime +1 -ls
```

#### 13. -perm：权限

```shell
# 普通文件一般为
find -perm 644 -ls
# 软链接为 777 
find -perm 777 -ls
```

### 3. 处理动作

#### 1. -print：默认

- 把搜索结果打印到屏幕上

```shell
find -perm 644 -print
```

#### 2. -ls：类似ll

```shell
find -perm 644 -ls
```

#### 3. -delete：删除

```shell
find -perm 644 -print
```

#### 4. -fls ls.txt：写入文件

```shell
# 将查找结果写入到文件中
find -perm 644 -fls ls.txt
```

#### 5. -ok/exec command {} \;

- 对查找到的文件执行 command 命令
- {}：表示搜索到的内容
- \;  ：为固定格式
- ok：需要确认，exec：不需要确认
- find传递内容时一次性传递的

```shell
# 需要确认
find -perm 644 -ok rm -rf {} \;
# 不需要确认
find -perm 644 -exec rm -rf {} \;
```

## xargs

- xargs：可以将命令的输出，一个个交给管道之后的命令
- 解决好多命令不支持管道，但工作中会用到的问题
- 有些命令不支持太多字符，也可以使用xargs

```shell
touch a{1..1000000}
echo a{1..1000000}|xargs touch
find -name * | xargs ls -l
ls a* | xargs rm -f
```

## grep

- Global search REgular expression and pring out the line，全局用正则搜索，并打印符合条件行
- 三剑客：grep、sed、awk，用于处理文本，都可以使用正则

#### 1. 用法 

- gerp [option]… pattern [file]

```shell
# 只要行内容包行 pattern 整行就会被输出
grep 'root' /etc/passwd
```

#### 2. 参数

1. `--color=auto`
   - `alias grep = 'grep --color'`
   - 将匹配到的文本添加颜色显示
2. -v：取反
3. -i：忽略大小写
4. -n：显示匹配行行号
5. -c：显示匹配的
6. -o：显示匹配的字符串
7. -q：静默模式，不输出内容，判断执行是否成功
8. -A n：输出匹配和后 n 行
9. -B n：输出匹配和前 n 行
10. -C n：输出匹配和前后 n 行
11. -e：或
12. -E：扩展正则表达式
13. -r：递归查找

```shell
# 显示没有匹配到的行
grep -v 'root' /etc/passwd

grep -q 'root' /etc/passwd
# $?上次命令结果的返回值，成功表示0，不成功为非0(1-255)
echo $?
# 输出匹配行以及其下 2 行
grep -nA 2 'root' /etc/passwd
# 输出匹配行以及其上 2 行
grep -nB 2 'root' /etc/passwd
# 输出匹配行以及前后 2 行
grep -nC 2 'root' /etc/passwd
# 或者
grep -e 'root' /etc/passwd -e 'mail' /etc/passwd
# 递归查找
grep -r 'root' /etc/
```

## 正则

- **注意和文件通配符区分**

1. .：任意
2. [abc]：abc的一个
3. [^abc]：取反
4. [:alnum:]：数字字母
5. [:alpha:]：字母
6. [:upper:]：大写字母A-Z
7. [:lower:]：小写字母a-z
8. [:digit:]：数字
9. [:punct:]：标点

```shell
grep "[[:alnum:]]*" b
grep "\W*" b

grep "a*.c" b
abc
ac
bc
dc
...
```

### 量词

1. `*`：任意次，默认时贪婪匹配
2. ？：0 或 1次，使用时需要转义 \?
3. `+`：至少1次，使用时需要转义 \+
4. {n}：匹配n次，使用时需要转义` \{n\}`
5. {m, n}：匹配n次，使用时需要转义` \{m, n\}`
6. {,n}：至多n次，使用时需要转义` \{,n\}`

```shell
grep "a\?c" b
grep "a\+c" b
```

### 位置锚定

1. ^：开头
2. $：结尾
3. ^$：空行

```shell
grep "^$" b
```

### 向后引用

- \1：表示前面第一个分组的引用

```shell
grep "\(.\+\) is \1" b
grep "\(l..e\).*\1" b
# 外边的是1，里面的是2分组
grep "\(l(..)e\).*\1\2" b
```

### egrep

- egrep = grep -E
- 标准正则需要转义此时不用转义

```shell
# 以下写法等价
grep -E "(l..e).*\1" b
egrep "(l..e).*\1" b
```

## 压缩

### 1. gzip

#### 1. 用法

- gzip [option]… [file]...

#### 2. 参数

1. -c：保留源文件
2. -d：解压
3. -9：**指定压缩比为 9，默认为9， 范围[1-9]** 

```shell
# 删除源文件压缩
gzip /etc/passwd
# 解压zip包，默认删除压缩包
gunzip /etc/passwd.gz

# 解压，删除压缩包
gzip -d /etc/passwd.gz
# 压缩，解压保留原文件
gzip -c /etc/passwd.gz > /etc/passwd
gzip -dc /etc/passwd.gz > /etc/passwd

# 值越大，压缩比越大
gzip -9 /etc/passwd 
gzip -1 /etc/passwd 

# 查看压缩包,可以输出到一文件，即变相解压
zcat /etc/passwd.gz > /etc/passwd
```

### 2. bzip2

- 生成 .bz2 文件

#### 参数

1. -d：解压缩
2. -k：保留源文件
3. -9：指定压缩比

```shell
bzip2 /etc/passwd
# 指定压缩比默认9
bzip2 -9 /etc/passwd
bzip2 -d /etc/passwd.bz2
bunzip2 /etc/passwd.bz2
# 保留源文件
bzip2 -k /etc/passwd.bz2
# 查看bz2文件
bzcat /etc/passwd.bz2
```

### 3. xz

- 生成 .xz 文件

#### 参数

1. -k：保留源文件
2. -d：解压
3. -9：指定压缩比

```shell
xz /etc/passwd
xz -d /etc/passwd.xz
unxz /etc/passwd.xz
# 
xz -9 /etc/passwd
# 查看.xz 文件
xzcat /etc/passwd.xz
```

### 4. tar 归档

- 只放进包里不压缩
- 参数 - 可省略

#### 参数

1. c：创建
2. v：显示过程
3. f：指定文件
4. r：追加
5. x：解包
6. -C：指定解压位置
7. j：使用 bzip2 压缩
8. z：使用 gzip 压缩
9. J：使用 xz 压缩
10. `--exclude=filename`：排除指定文件

```shell
# 打包
tar cvf a.tar b c
# 追加 d 到 a.tar
tar -r -f a.tar d

# 解包
tar xf a.tar
tar xf a.tar -C /opt
# 使用 bzip2 压缩，和解压
tar jcvf a.tar.bz f1 f2 f3
tar jxvf a.tar.bz
# 使用 gzip 压缩，和解压
tar zcvf a.tar.gz f1 f2 f3
tar zxvf a.tar.bz
# 使用 xz 压缩，和解压
tar Jcvf a.tar.xz f1 f2 f3
tar Jxvf a.tar.xz

# 不指定压缩格式的解压， 默认解压到当前目录
tar xvf a.tar.xz

# 排除指定文件
tar zcf etc.tar.gz --exclude=/etc/yum.repos.d --excllude=yum.conf /etc/
```

### split 分卷压缩

- 只能压缩文件

#### 用法

`split -b size filename -d tarfile`

`cat tarfile* > tarfile`

#### 参数

1. -b：指定分卷大小
2. -d：指定数字为后缀，默认是字母

```shell
# 大文件切分压缩
split -b 1M b -d b.tar.gz  
# 合并
cat b.tar.gz0* > b.tar.gz
```













