# 用户和用户组

## 1. motd

- message of the day
- 登录提示内容
- /etc/motd

## 2. 用户

### 1.用户分类

1. root：id为 0
2. 普通用户：
   - 系统用户：一般情况下启动服务或者运行进程，不可以登录，id 为 1-999/centos 7, 1-499/centos6。
   - 可登录用户：可以登录系统的，1000-65535/centos7，500-65535/cenos6。

### 2. useradd

- 只能root用户执行

#### 1. 参数(10)

1. -d：指定用户的家目录，默认在/home，不可以指定为 /temp 目录
2. -u：指定用户id
3. -g：指定用户的用户组，可以使用 gid / name
4. -G：指定用户的附加组
5. -M：不创建用户家目录
6. -N：不创建组，默认继承自 users 
7. -r：创建系统用户，id 从1000依次递减
8. -s：指定用户登录后使用的 shell，/sbin/nologin（可以登录看到提示信息，会立马踢掉）
9. -D：显示默认配置(可以和 -b，-s，-g连用)
10. -b：修改默认的家目录

```shell
useradd echo
useradd -d /opt/echo echo
# gid：有且只能有一个，—G：指定附加组，可以有多个
useradd -G root,echo dean
# 默认继承自， users
useradd -N dean1
# 创建系统用户
useradd -r henry
# 指定用户登录使用的shell
useradd -s /sbin/nologin dean2
passwd dean2						# 给dean2 设置登录密码

# 如果不指定uid，则系统会找到最大的 uid 进行递增
useradd -u 3000 dean3
useradd dean4
```

- 修改默认配置

```shell
# 修改默认登录shell
useradd -D -s /sbin/nologin
# 修改默认的家目录
useradd -D -b /opt
# 修改默认组
useradd -D -g 3000
```

#### 2. 配置文件

```shell
cat /etc/default/useradd
# 用户家目录的模版
ll -a /etc/skel/.
```

- 存放用户位置：/etc/passwd(7部分)

```shell
henry:   x:    1000:1000:henry: /home/henry:/bin/bash
用户名 密码占位符 uid  gid  描述信息   家目录     使用shell
```

### 3. usermod

#### 参数

1. -L：锁定用户，用户无法登录，默认情况下：修改用户密码即解锁
2. -U：解锁用户
3. -m：移动家目录
4. -d：新的家目录，不会自己创建，要使用-m选项
5. -g：修改主组
6. -G：修改附加组
7. -a：追加附加组，**需要和G一起连用**
8. -l：改名
9. -s：改shell

```shell
# 登录会进入 / 目录
usermod -d /usr/henry henry 
# -d 一般和 -m 连用
usermod -md /usr/local/henry henry 
# 追加附加组，需要和G一起连用
usermod -aG dean henry
```

### 4. userdel

#### 参数(1)

1. -r：删除用户以及家目录和mail pool

```shell
# 删除用户和家目录和mail pool
userdel -r dean2
```

### 5. passwd

- root only

#### 参数(9)

1. -d：删除用户密码
2. -l：锁定用户
3. -u：解锁用户
4. -e：强制用户下次登录时，修改密码
5. -x maxdays：密码最长有效期，默认是 day
6. -n mindays：密码最短有效期
7. -w days：提前通知用户密码到期时间
8. -i days：密码过期多少天禁用
9. `-—stdin`：从标准输入读取密码，不需要二次确认

```shell
passwd -i 7 dean
# 用于脚本，自动修改，交互的内容获取不到
echo 'passwd' ｜ passed --stdin username
```

### 6. chage

#### 参数(7)

1. -d：将密码修改时间设置为指定时间
2. -E：设置用户过期时间
3. -I：密码过期多长时间以后账户被禁用
4. -l：list用户密码策略
5. -m days：密码最多使用期
6. -M days：密码最长使用期
7. -W days：密码过期的警告天数

```shell
# 交互式更改用户密码策略
chage dean
```

- 配置文件
  1. 用户名
  2. 密码
  3. 18106：从unix元年到密码最近一次修改的时间
  4. 0：密码最小使用期限
  5. 99999：密码最大使用期限
  6. 7：密码过期前提前 7 天通知用户，默认是 7 天
  7. 20：密码过期 20 天被锁定，
  8. 最后一个：从unix元年，多少天账户失效

```shell
cat /etc/shadow
# $6$ ： sha-512，6表示加密方式，ahzn7peGcStDon3：加盐，剩下的为加密字符串
henry:$6$.ahzn7peGcStDon3$kI8HHtL5V0CHFS4VMb9.8yag5Qyq2a9CqjA3zyqFwnEHJYtzAOgDdDr7JzEiABusYOpZG.6BGvfyqjZvxABHk/:18106:0:99999:7:20::
```

### 7. su和sudo

#### 1. su

- su username，从root切换，不需要密码
- su - username，完全切换，切换用户家目录和环境变量

```shell
su username
# 完全切换，切换用户家目录和环境变量
su - username
# 获取用户权限，执行命令
su - root -c 'useradd dean3'
```

#### 2. sudo

- /etc/sudoers
  - 添加用户：henry  ALL=(ALL)    [NOPASSWD:]ALL
  - 添加用户组：%wheel    ALL=(ALL)   [NOPASSWD:] ALL
  - (ALL)：允许执行的命令
  - NOPASSWD：不需要输入密码

```shell
vim /etc/sudoers
添加：henry  ALL=(ALL) ALL
sudo useradd dean4
```

## 3. 用户组

### 1. 分类

- gid取值和uid相同

1. root组：root ID为0
2. 普通用户组
   - 系统组
   - 可登录用户组

### 2. groupadd

#### 1. 参数(2)

1. -g：指定gid
2. -r：指定系统组

```shell
groupadd oleg
cat /etc/
```

#### 2. 配置文件

- /etc/group
- /etc/gshadow

1. henry：组名
2. x：密码占位符
3. 1000：gid
4. dean：以当前组为附加组的用户列表

```shell
# /etc/group
henry:x:1000:dean
# /etc/gshadow

```

### 3. groupmod

- -g：修改gid
- -n：修改gname

```shell
groupmod -g henry 3000
groupmod -n henry henryboos
```

### 4. groupdel

```shell
groupdel dean
```

## 4. 两种认证方式

- 用户名和密码
- 用户名和key

```shell
# 生成key
ssk-keygen
# 公钥和私钥，非对称加密
Your identification has been saved in /root/.ssh/id_rsa.
# 公钥
Your public key has been saved in /root/.ssh/id_rsa.pub.
+---[RSA 2048]----+
|        .o+      |
|        .= .     |
|       .. = o .  |
|  . . .. = o +   |
| o o + .S O .    |
|  + = = o@ o     |
|   = B..=.*      |
|    E+.  +o+     |
|    .++   ++     |
+----[SHA256]-----+
# copy公钥到远程服务器
ssh-copy-id root@ip
# 直接登录，公加密私解密
ssh root@ip
```

# 磁盘相关

### 1. df

- 查看磁盘空间占用率

```shell
df -h
```

### 2. mount

- 查看挂载信息

```shell
mount
```

### 3. du

- 显示目录的占用空间大小

#### 参数

1. -h：自动调节显示单位
2. -s：显示当前目录占用情况

```shell
du -h file
# 显示根目录的占用情况
du -sh /
# 显示指定目录下的每一个文件
du -sh /*
```

### 4. dd

1. 复制文件生成文件
2. if：表示来源，input file
3. of：表示输出，output file
4. bs：block size，**只能用整数**，单位可以是K M G T

```shell
dd if=/def/zero of=/dev/null bs=10M count=10
```

### 5. RAID

### 1. RAID0

- 数据分开存储
- 一般用于装系统

1. 读写速度提生 磁盘个数N-1倍
2. 可用空间: 单个磁盘容量*磁盘个数N
3. 没有容错能力
4. 最少需要2块磁盘

### 2. RAID1

- 数据备份存储
- 保存数据

1. 读取速度提升，写的速度稍下降
2. 可用空间：单个磁盘容量
3. 有容错能力
4. 最少需要2块磁盘

### 3. RAID5

- 数据分开存储，并存储校验值，校验值存储随机选取一个磁盘存储
- 目前较为流行

1. 读写速度提升
2. 可用空间，磁盘容量*磁盘个数N-1
3. 有容错能力：最多坏1块
4. 最少需要3块磁盘

#### RAID6

- 新技术

1. 读写性能提升
2. 可用空间：单个磁盘容量*磁盘个数N-2
3. 有容错能力：最多可以坏2块
4. 至少需要4块磁盘

### 4. RAID10

- 先做RAID 1 在做RAID 0

1. 读写性能提升
2. 可用空间：单个磁盘容量*磁盘个数N/2
3. 有容错能力：一个组中只能坏1块
4. 至少需要4块

#### RAID01

- 先做RAID 0 在做RAID 1

1. 有容错能力：一个组中只能坏1块

#### 软RAID

1. 磁盘分区做RAID

# 包管理工具

## 1. 介绍

- Cnetos/redhat：rpm / redhat package manager

## 2. yum

- -q：静默模式
- -y

### 1. 会解决包依赖关系

```SHELL
# 配置aliyun的yum源
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
# 清空缓存
yum clean all
yum makecache
```

```shell
# 1.使用YUM查找软件包 
yum search 
# 2.列出所有可安装的软件包 
yum list 
# 3.列出所有可更新的软件包 
yum list updates 
# 4.列出所有已安装的软件包 
yum list installed 
# 5.列出所有已安装但不在 Yum Repository 内的软件包 
yum list extras 
# 6.列出所指定的软件包 
yum list 
# 7.使用YUM获取软件包信息，安装和未安装的都可以查看
yum info 包名
# 8.列出所有可更新的软件包信息 
yum info updates 
# 9.列出所有已安装的软件包信息 
yum info installed 
# 10.列出所有已安装但不在 Yum Repository 内的软件包信息 
yum info extras 
# 11.搜索命令由哪个包生成，如果有filename则是以安装命令
yum provides 命令名
# 12.列出yum仓库信息
yum repolist
# 13.重新安装
yum reinstall
# 14.卸载包
yum remove 包名
```

- 包组

```shell
# 1.列出yum的包组，如：Development Tools(开发包信息api数据)
yum grouplist
yum install python3-devel
# 2.安装/卸载包组
yum group install/remove 包名
# 3.查看包组的info
yum group info 包名
# 4.检查包的依赖关系
yum deplist 包名
```

### 2. rpm命令

```shell
[root@localhost ~]# rpm -q python
python-2.7.5-68.el7.x86_64
# 检查包是否安装
rpm -q 包名
# 列出所有已安装的包
rpm -qa
# 查看指定文件是由那个包生成
rpm -qf /etc/ssh/sshd_config
# 查询安装 python 生成的文件
rpm -ql python
# 查询包的详细信息
rpm -qi python
# 查询 python 包的配置文件
rpm -qc python
# 查询 python 依赖的库文件
rpm -qR python
# 显示帮助信息
rpm -qd python
# 卸载 python 包，不会卸载依赖，yum会卸载依赖
rpm -e pyhon
```

- 包命名规范

```shell
# el7是redhat 7 系列
python-2.7.5-68.el7.x86_64
name-version(大版本.小版本.修订版)-作者修订次数.适用操作系统.架构
# noarch：不区分架构
# x86_64
# Amd64
# x86 i3/4/5/686  32位架构
# ppc(power pc), IBM
```

## 3. yum配置

- 配置文件目录：/etc/yum.repo.d
- 后缀：repo
- $release：当前os的发行的主版本号
- $basearch：基础平台

```shell
[epel]			# 名字
name				# 描述信息
# 包的路径，可以是http://，https://，ftp://，file://(本地)
baseurl=
# 设置访问规则
failovermethod=
# 是否开启该配置，0:禁用
enabeled=1
# 是否进行检查 gpgkey ，0:不检查，1检查
gpgcheck=0
gpgkey=
```

## 4. yum源

- 清华
- aliyun
- mirrors.163.com
- mirrors.huaweicloud.com
- mirrors.cloud.tencent.com

## 5. 编译安装

- 优点：可以自定义功能
- 缺点：安装耗时

```shell
wget url
# 安装lrzsz包，上传文件到centos
yum install lrzs
# 拖上传文件
rz -E
# 下载到本地
sz a.txt 
# 解压
tar -xf xxx.xxx.tar.xz
# 进入包文件
# 查阅 INSTALL / REDEME.rst
./configure --help
```

-  源码编译安装流程

```shell
1.指定安装路径，检查环境预处理，创建 makefile文件
./configure --prefix=/opt/python36
2.安装gcc编译程序，重新执行第一步
yum install gcc -y
3.释放makefile文件
make
4.安装
make install
5.包不可用，安装后删除makefile文件重新执行步骤1
yum install zlib-devel -y
6.配置环境变量
# 临时生效
PATH=$PATH:/opt /ptyhon/bin
# 永久生效
vim /etc/profile.d/python.sh
PATH=$PATH:/opt /ptyhon/bin
PATH=/opt /ptyhon/bin:$PATH
source /etc/profile.d/python.sh
```

- python里的随机数是根据cpu中的时间片计算出来的


